<project name="haxeServer" default="deploy-all">
	
	<property name="build.server.dir" value="output/server"/>
	<property name="build.admin.dir" value="output/admin"/>
	
	<taskdef name="svn" classname="org.tigris.subversion.svnant.SvnTask"/>
	<taskdef name="if" classname="ise.antelope.tasks.IfTask"/>
	
	<target name="svn-update">
		<if name="svn.update" value="true">
			<svn javahl="false" svnkit="true" username="canab.ua" password="gM9by4kJ5MB2">
				<update dir=".."/>
			</svn>
			<else>
				<echo>disabled</echo>
			</else>
		</if>
	</target>
	
	<target name="deploy-all" depends="build-all, deploy-server, deploy-admin"/>
	<target name="build-all" depends="build-server, build-admin"/>
	
	<target name="deploy-server" depends="build-server">
		<delete dir="${deploy.server.dir}"/>
		<mkdir dir="${deploy.server.dir}"/>
	 	<copy todir="${deploy.server.dir}">
	 		<fileset dir="${build.server.dir}"/>
	 	</copy>
	</target>
	
	<target name="deploy-admin" depends="build-admin">
		<delete dir="${deploy.admin.dir}"/>
		<mkdir dir="${deploy.admin.dir}"/>
	 	<copy todir="${deploy.admin.dir}">
	 		<fileset dir="${build.admin.dir}"/>
	 	</copy>
	</target>
	
	<target name="build-server" depends="svn-update">
		<delete dir="${build.server.dir}"/>
		<mkdir dir="${build.server.dir}"/>
		
		<condition property="haxe.compiler.debug" value="-debug" else="">
			<istrue value="${build.server.debug}"/>
		</condition>
		
		<exec executable="${haxe.compiler}" failonerror="true">
			<arg line="-cp ../server/src"/>
			<arg line="-cp ../library"/>
			<arg line="-main NekoServer"/>
			<arg line="-neko ${build.server.dir}/server.n"/>
			<arg line="${haxe.compiler.debug}"/>
		</exec>
	</target>
	
	<target name="build-admin" depends="svn-update">
		<delete dir="${build.admin.dir}"/>
		<mkdir dir="${build.admin.dir}"/>
	</target>
</project>